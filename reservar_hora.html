<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
    <title>Huellas del corazon</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="style/reservar_hora.css">
</head>

<header>
    <div class="container-fluid" id="banner">
        <div class="row">
            <div class="col-md">
            </div>
            <div class="col-md">
                <div class="text-center">
                    <br>
                    <img src="img/Logo.png" alt="uwu" style="max-width: 50%;">
                    <br><br>
                </div>
            </div>
            <div class="col-md text-end">
                <br>
                <a class="btn btn-outline-secondary" href="registrar_usuarios.html" role="button"
                    id="btn_login">Registrar</a>
                <br>
            </div>
        </div>
    </div>
</header>


<body style="background-color: #e7e7e7;">

    <!-------------------->
    <!-- INICIO NAVBAR -->
    <!-------------------->

    <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #74DBA3;">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item">
                        <a class="btn btn-outline-dark" href="index.html">INICIO</a>
                    </li>
                    <li class="nav-item">
                        <a class="btn btn-outline-dark" href="quienes_somos.html">¿QUIENES SOMOS?</a>
                    </li>
                    <li class="nav-item">
                        <a class="btn btn-outline-dark" href="servicios.html">SERVICIOS</a>
                    </li>
                    <li class="nav-item">
                        <a class="btn btn-outline-dark" href="reservar_hora.html">RESERVAR/CONSULTAR HORA</a>
                    </li>
                    <li class="nav-item">
                        <a class="btn btn-outline-dark" href="profesionales.html">PROFESIONALES</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-------------------->
    <!-- FINAL NAVBAR -->
    <!-------------------->
    <div class="wrapper fadeInDown">
        <div id="formContent">
            <!-- Tabs Titles -->

            <!-- Icon -->
            <div class="fadeIn first">
                <img src="img/LOGO.png" alt="" id="icon">
            </div>

            <!-- Formulario de la ficha del paciente -->
            <form id="formulario">
                <input type="text" id="owner" class="fadeIn second" name="owner" placeholder="Dueño">
                <div id="owner-error" class="error"></div>
                <input type="text" id="pet" class="fadeIn third" name="pet" placeholder="Nombre del Paciente/Mascota">
                <div id="pet-error" class="error"></div>
                <select id="animals" name="animales" class="fadeIn fourth">
                    <option>Seleccione una opción</option>
                    <option>Canino</option>
                    <option>Felino</option>
                    <option>Roedor</option>
                    <option>Ave</option>
                    <option>Pez</option>
                    <option>Equino</option>
                    <option>Otros</option>
                </select>
                <div id="animal-error" class="error"></div>
                <select id="doctor" name="doctor" class="fadeIn fourth">
                    <option>Seleccione a un médico</option>
                    <option>Juan De la Cruz Villaroel (Animales mayores)</option>
                    <option>Javiera Maturana (Animales menores)</option>
                    <option>Johan Sandoval (Animales exóticos)</option>
                    <option>Camila Valdebenito (Atención general)</option>
                </select>
                <div id="doctor-error" class="error"></div>
                <input type="text" id="contact" class="fadeIn fiveth" name="contact" placeholder="Email">
                <div id="contact-error" class="error"></div>
                <input type="date" name="" id="date" class="fadeIn third" name="date" min="2023-01-01" max="2034-12-31">
                <div id="date-error" class="error"></div>
                <input type="text" id="message" class="fadeIn sixth" name="message" placeholder="Motivo de consulta">
                <div id="message-error" class="error"></div>
                <button type="button" class="fadeIn fourth" id="boton-enviar">Agendar mi hora</button>
                <button type="button" class="fadeIn fourth" onclick="location.href='consultar_hora.html'">Consultar mi
                    hora</button>
            </form>
        </div>
    </div>
    <!-- Bootstrap script -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <div class="footer-basic">
        <footer>
            <div class="social"><a href="#"><i class="icon ion-social-instagram"></i></a><a href="#"><i
                        class="icon ion-social-snapchat"></i></a><a href="#"><i
                        class="icon ion-social-twitter"></i></a><a href="#"><i class="icon ion-social-facebook"></i></a>
            </div>
            <ul class="list-inline">
                <li class="list-inline-item"><a href="#">Inicio</a></li>
                <li class="list-inline-item"><a href="#">Servicios</a></li>
                <li class="list-inline-item"><a href="#">Quiénes somos</a></li>
                <li class="list-inline-item"><a href="#">Términos y condiciones</a></li>
                <li class="list-inline-item"><a href="#">Política de Privacidad</a></li>
            </ul>
            <p class="copyright">Huellas del Corazón © 2023</p>
        </footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script type="module">

        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDV3sJ563y6e1N567noDSBLf0unlicpYT4",
            authDomain: "huellas-del-corazon-6fbf9.firebaseapp.com",
            databaseURL: "https://huellas-del-corazon-6fbf9-default-rtdb.firebaseio.com",
            projectId: "huellas-del-corazon-6fbf9",
            storageBucket: "huellas-del-corazon-6fbf9.appspot.com",
            messagingSenderId: "711559984417",
            appId: "1:711559984417:web:192bfb619768879237fa60"
        };

        const app = initializeApp(firebaseConfig);
        import { getDatabase, set, get, update, remove, ref, child } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-database.js"

        const db = getDatabase();

        var owner = document.querySelector("#owner");
        var pet = document.querySelector("#pet");
        var contact = document.querySelector("#contact");
        var message = document.querySelector("#message");
        var animals = document.querySelector("#animals");
        var date = document.querySelector("#date");
        var doctor = document.querySelector("#doctor");
        var btn_enviar = document.querySelector("#boton-enviar");

        //Validaciones por si los campos no están rellenos

        var ownerError = document.getElementById("owner-error");
        var petError = document.getElementById("pet-error");
        var contactError = document.getElementById("contact-error");
        var messageError = document.getElementById("message-error");
        var animalError = document.getElementById("animal-error");
        var dateError = document.getElementById("date-error");
        var doctorError = document.getElementById("doctor-error");

        const expression = /[a-zA-Z0-9._-]+\@(hotmail|outlook|gmail)\.(com|es|cl)/;

        //Generador de ID

        function stringGen() {
            var text = "";
            var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
            for (var i = 0; i < 9; i++)
                text += possible.charAt(Math.floor(Math.random() * possible.length));

            return text;
        }

        function insertData() {
            if (owner.value == "") {
                ownerError.innerHTML = "Este campo es requerido";
            }
            if (pet.value == "") {
                petError.innerHTML = "Este campo es requerido";
            }
            if (contact.value == "") {
                contactError.innerHTML = "Este campo es requerido";
            } else if (!expression.test(contact.value)) {
                contactError.innerHTML = "Ingrese un correo válido";
            }
            if (message.value == "") {
                messageError.innerHTML = "Este campo es requerido";
            }
            if (date.value == "") {
                messageError.innerHTML = "Este campo es requerido";
            }
            if (animals.value == "Seleccione una opción") {
                animalError.innerHTML = "Este campo es requerido";
            }
            if (doctor.value == "Seleccione a un médico") {
                messageError.innerHTML = "Este campo es requerido";
            }
            if (owner.value == "" || pet.value == "" || animals.value == "Seleccione una opción" || contact.value == "" || !expression.test(contact.value) || message.value == "") {

                Swal.fire({
                    icon: 'error',
                    title: 'Algo salió mal...',
                    text: 'Los campos no deben estar vacíos!',
                })
            }
            else {

                set(ref(db, "ficha paciente/" + stringGen()), {

                    Dueño: owner.value,
                    Mascota: pet.value,
                    Contacto: contact.value,
                    Motivo_consulta: message.value,
                    Tipo_Animal: animals.value,
                    Fecha_consulta: date.value,                    
                    Doctor: doctor.value
                }).then(() => {
                    let timerInterval
                    Swal.fire({
                        title: 'Redireccionando...',
                        html: 'La página se está cargando!',
                        didOpen: () => {
                            Swal.showLoading()
                            const b = Swal.getHtmlContainer().querySelector('b')
                            timerInterval = setInterval(() => {
                                b.textContent = Swal.getTimerLeft()
                            })
                            window.location.href = "https://www.flow.cl/btn.php?token=id8u6bl"
                        },
                        willClose: () => {
                            clearInterval(timerInterval)
                        }
                    }).then((result) => {
                        /* Read more about handling dismissals below */
                        if (result.dismiss === Swal.DismissReason.timer) {
                            console.log('I was closed by the timer')
                        }
                    })
                })
                    .catch((error) => {
                        alert(error)
                    });
            }
        }
        btn_enviar.addEventListener('click', insertData)
    </script>

</body>

</html>